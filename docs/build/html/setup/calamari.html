

<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Calamari &mdash; Mozhi 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato" type="text/css" />
  <link rel="stylesheet" href="../_static/css/mozhi_style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

</head>

<body>
    <header>
        <div class="container">
            <a class="site-nav-toggle hidden-lg-up"><i class="icon-menu"></i></a>
            <a class="site-title" href="../index.html">
                Mozhi
            </a>
        </div>
    </header>


<div class="breadcrumbs-outer hidden-xs-down">
    <div class="container">
        















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="breadcrumbs">
    
      <li><a href="../index.html">Docs</a></li>
        
      <li>Calamari</li>
    
    
      <li class="breadcrumbs-aside">
        
            
            <a href="../_sources/setup/calamari.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
</div>
    </div>
</div>
    <div class="main-outer">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-3 site-nav">
                    
<div role="search">
    <form class="search" action="../search.html" method="get">
        <div class="icon-input">
            <input type="text" name="q" placeholder="Search" />
            <span class="icon-search"></span>
        </div>
        <input type="submit" value="Go" class="d-hidden" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div>
                    <div class="site-nav-tree">
                        
                            
                            
                                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Developers Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="on_minikune.html">Minikube</a></li>
<li class="toctree-l2"><a class="reference internal" href="prepare_data.html">Load and Prepare Demo Data for UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_machine.html">Setting up Developer Machine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dev_machine.html#installations">Installations</a></li>
<li class="toctree-l3"><a class="reference internal" href="dev_machine.html#folder-structure">Folder Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html">mozhi API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api.html#setup-requirements">Setup Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html#local-machine">Local Machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html#docker">Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html#kubernetes">Kubernetes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ocr.html">OCR</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ocr.html#docker">Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="ocr.html#models">Models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ui.html">mozhi UI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ui.html#setup-requirements">Setup Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui.html#local-machine">Local Machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui.html#docker">Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui.html#kubernetes">Kubernetes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hf_model_training.html">Hugging Face Transformers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="hf_model_training.html#preparing-the-model">Preparing the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="hf_model_training.html#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pt_model_training.html">Pytorch</a></li>
<li class="toctree-l2"><a class="reference internal" href="google_drive_fuse.html">Google Drive Fuse</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../study_materials/study_materials.html">Mozhi Study Materials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../study_materials/dl.html">Deep Learning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../study_materials/dl.html#loss-functions">Loss Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../study_materials/model_serving.html">Model Serving</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../study_materials/model_serving.html#tensorflow-model-serving">Tensorflow Model Serving</a></li>
<li class="toctree-l3"><a class="reference internal" href="../study_materials/model_serving.html#pytorch-serve">PyTorch Serve</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../study_materials/must_have_maths.html">Must Have</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../study_materials/must_have_maths.html#kl-divergence">KL Divergence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../study_materials/must_have_maths.html#cross-entorpy">Cross Entorpy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../study_materials/must_have_maths.html#residula-connection">Residula connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../study_materials/tf.html">Tensorflow Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../study_materials/transformers.html">Transformers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ner/ner.html">NER - Named Entity Recognition</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ner/ner.html#what-is-ner">What is NER?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ner/ner.html#use-cases-of-ner">Use cases of NER?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ner/ner.html#methods-to-extract-ner">Methods to extract NER</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ner/intro.html">NER - Named Entity Recognition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ner/datasets.html">NER Datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ner/deeplearning.html">Deep Learning Approaches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ner/papers.html">Papers Related to NER</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ner/references.html">Wild References</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                            
                        
                    </div>
                </div>
                <div class="col-12 col-lg-9">
                    <div class="document">
                        
                            
  <div class="section" id="calamari">
<h1><a class="reference external" href="https://github.com/Calamari-OCR/calamari_models/">Calamari</a><a class="headerlink" href="#calamari" title="Permalink to this headline">¶</a></h1>
<div class="section" id="dataset">
<h2>Dataset:<a class="headerlink" href="#dataset" title="Permalink to this headline">¶</a></h2>
<p>Task 1 from <a class="reference external" href="https://rrc.cvc.uab.es/?ch=13">https://rrc.cvc.uab.es/?ch=13</a></p>
<p>For receipt OCR task, each image in the dataset is annotated with text bounding boxes (bbox)
and the transcript of each text bbox. Locations are annotated as rectangles with four vertices,
which are in clockwise order starting from the top. Annotations for an image are stored in a text
file with the same file name. The annotation format is similar to that of ICDAR2015 dataset,
which is shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x1_1</span><span class="p">,</span> <span class="n">y1_1</span><span class="p">,</span><span class="n">x2_1</span><span class="p">,</span><span class="n">y2_1</span><span class="p">,</span><span class="n">x3_1</span><span class="p">,</span><span class="n">y3_1</span><span class="p">,</span><span class="n">x4_1</span><span class="p">,</span><span class="n">y4_1</span><span class="p">,</span> <span class="n">transcript_1</span>
<span class="n">x1_2</span><span class="p">,</span><span class="n">y1_2</span><span class="p">,</span><span class="n">x2_2</span><span class="p">,</span><span class="n">y2_2</span><span class="p">,</span><span class="n">x3_2</span><span class="p">,</span><span class="n">y3_2</span><span class="p">,</span><span class="n">x4_2</span><span class="p">,</span><span class="n">y4_2</span><span class="p">,</span> <span class="n">transcript_2</span>
<span class="n">x1_3</span><span class="p">,</span><span class="n">y1_3</span><span class="p">,</span><span class="n">x2_3</span><span class="p">,</span><span class="n">y2_3</span><span class="p">,</span><span class="n">x3_3</span><span class="p">,</span><span class="n">y3_3</span><span class="p">,</span><span class="n">x4_3</span><span class="p">,</span><span class="n">y4_3</span><span class="p">,</span> <span class="n">transcript_3</span>
</pre></div>
</div>
</div>
<div class="section" id="docker-image">
<h2>Docker Image<a class="headerlink" href="#docker-image" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd /path/to/mozhi/
docker build -t mozhi-ocr-gpu:latest -f ops/docker/ocr/Dockerfile .

docker container  \
run --network host \
--gpus all -it \
--rm --name mozhi-ocr-gpu \
-v $(pwd)/data/SROIE2019/:/data/ \
mozhi-ocr-gpu:latest bash 
</pre></div>
</div>
<p>Prepare data on Machine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd /path/to/mozhi/
export PYTHONPATH=$PYTHONPATH:$(pwd)/mozhi/
python mozhi/ocr/text_cropping/cropping.py --input_dir=data/SROIE2019/0325updated.task1train\(626p\)/ \
--file_ext=.jpg \
--out_dir=data/SROIE2019/cropped/ \
--num_threads=8
</pre></div>
</div>
<p>Calamari Training on Docker:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="mi">0325</span><span class="n">updated</span><span class="o">.</span><span class="n">task1train</span>\<span class="p">(</span><span class="mi">626</span><span class="n">p</span>\<span class="p">)</span><span class="o">/</span>

<span class="n">calamari</span><span class="o">-</span><span class="n">train</span> \
<span class="o">--</span><span class="n">device</span><span class="o">.</span><span class="n">gpus</span> <span class="mi">0</span> \
<span class="o">--</span><span class="n">trainer</span><span class="o">.</span><span class="n">gen</span> <span class="n">SplitTrain</span> \
<span class="o">--</span><span class="n">trainer</span><span class="o">.</span><span class="n">gen</span><span class="o">.</span><span class="n">validation_split_ratio</span><span class="o">=</span><span class="mf">0.2</span>  \
<span class="o">--</span><span class="n">trainer</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">model</span><span class="o">-</span><span class="n">output</span><span class="o">/</span> \
<span class="o">--</span><span class="n">trainer</span><span class="o">.</span><span class="n">epochs</span> <span class="mi">25</span> \
<span class="o">--</span><span class="n">early_stopping</span><span class="o">.</span><span class="n">frequency</span><span class="o">=</span><span class="mi">1</span> \
<span class="o">--</span><span class="n">early_stopping</span><span class="o">.</span><span class="n">n_to_go</span><span class="o">=</span><span class="mi">3</span> \
<span class="o">--</span><span class="n">train</span><span class="o">.</span><span class="n">images</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">cropped</span><span class="o">/*.</span><span class="n">jpg</span>
</pre></div>
</div>
</div>
</div>


                        
                    </div>
                </div>
            </div>
        </div>
    </div>    


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  
    <div class="footer" role="contentinfo">
        <div class="container">
            &#169; Copyright 2021, Mozhi.
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.0.1.
        </div>
    </div>  

</body>
</html>
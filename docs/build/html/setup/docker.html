

<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Docker &mdash; Mozhi 0.0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato" type="text/css" />
  <link rel="stylesheet" href="../_static/css/mozhi_style.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 

</head>

<body>
    <header>
        <div class="container">
            <a class="site-nav-toggle hidden-lg-up"><i class="icon-menu"></i></a>
            <a class="site-title" href="../index.html">
                Mozhi
            </a>
        </div>
    </header>


<div class="breadcrumbs-outer hidden-xs-down">
    <div class="container">
        















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="breadcrumbs">
    
      <li><a href="../index.html">Docs</a></li>
        
      <li>Docker</li>
    
    
      <li class="breadcrumbs-aside">
        
            
            <a href="../_sources/setup/docker.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>
</div>
    </div>
</div>
    <div class="main-outer">
        <div class="container">
            <div class="row">
                <div class="col-12 col-lg-3 site-nav">
                    
<div role="search">
    <form class="search" action="../search.html" method="get">
        <div class="icon-input">
            <input type="text" name="q" placeholder="Search" />
            <span class="icon-search"></span>
        </div>
        <input type="submit" value="Go" class="d-hidden" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div>
                    <div class="site-nav-tree">
                        
                            
                            
                                <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Developers Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="on_minikune.html">Minikube</a></li>
<li class="toctree-l2"><a class="reference internal" href="prepare_data.html">Load and Prepare Demo Data for UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_machine.html">Setting up Developer Machine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="dev_machine.html#installations">Installations</a></li>
<li class="toctree-l3"><a class="reference internal" href="dev_machine.html#folder-structure">Folder Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html">mozhi API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="api.html#setup-requirements">Setup Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html#local-machine">Local Machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html#docker">Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html#kubernetes">Kubernetes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ocr.html">OCR</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ocr.html#docker">Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="ocr.html#models">Models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="ui.html">mozhi UI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="ui.html#setup-requirements">Setup Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui.html#local-machine">Local Machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui.html#docker">Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="ui.html#kubernetes">Kubernetes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hf_model_training.html">Hugging Face Transformers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="hf_model_training.html#preparing-the-model">Preparing the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="hf_model_training.html#testing">Testing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="pt_model_training.html">Pytorch</a></li>
<li class="toctree-l2"><a class="reference internal" href="google_drive_fuse.html">Google Drive Fuse</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../study_materials/study_materials.html">Mozhi Study Materials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../study_materials/dl.html">Deep Learning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../study_materials/dl.html#loss-functions">Loss Functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../study_materials/model_serving.html">Model Serving</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../study_materials/model_serving.html#tensorflow-model-serving">Tensorflow Model Serving</a></li>
<li class="toctree-l3"><a class="reference internal" href="../study_materials/model_serving.html#pytorch-serve">PyTorch Serve</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../study_materials/must_have_maths.html">Must Have</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../study_materials/must_have_maths.html#kl-divergence">KL Divergence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../study_materials/must_have_maths.html#cross-entorpy">Cross Entorpy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../study_materials/must_have_maths.html#residula-connection">Residula connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../study_materials/tf.html">Tensorflow Guides</a></li>
<li class="toctree-l2"><a class="reference internal" href="../study_materials/transformers.html">Transformers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ner/ner.html">NER - Named Entity Recognition</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ner/ner.html#what-is-ner">What is NER?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ner/ner.html#use-cases-of-ner">Use cases of NER?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ner/ner.html#methods-to-extract-ner">Methods to extract NER</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../ner/intro.html">NER - Named Entity Recognition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ner/datasets.html">NER Datasets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ner/deeplearning.html">Deep Learning Approaches</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ner/papers.html">Papers Related to NER</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ner/references.html">Wild References</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                            
                        
                    </div>
                </div>
                <div class="col-12 col-lg-9">
                    <div class="document">
                        
                            
  <div class="section" id="docker">
<h1>Docker<a class="headerlink" href="#docker" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup">
<h2>1. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>https://hub.docker.com/r/nvidia/cuda</p></li>
<li><p>https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker</p></li>
<li><p><a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-18-04">https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-18-04</a></p></li>
<li><p><a class="reference external" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p></li>
</ul>
<p><strong>docker cli</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo apt  install docker.io

sudo systemctl start docker
sudo systemctl enable docker
docker --version

# Put the user in the docker group
sudo usermod -a -G docker $USER
newgrp docker
</pre></div>
</div>
<p><strong>docker-compose cli</strong></p>
<p>https://docs.docker.com/compose/install/</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
<p><strong>Nvidia container toolkit</strong></p>
<p>Nvidia has prebuild iamges for GPU support inside the container, which can be used with
<code class="docutils literal notranslate"><span class="pre">nvidia-container-toolkit</span></code></p>
<p>Note : The prebuild images are huge <code class="docutils literal notranslate"><span class="pre">~10GB</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo apt install curl
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list

sudo apt-get update &amp;&amp; sudo apt-get install -y nvidia-container-toolkit
sudo systemctl restart docker

# Check Docker image
docker run --gpus all nvidia/cuda:10.2-base nvidia-smi

## Running GUI Applications
xhost +local:docker
docker run --gpus all -it \
    -e DISPLAY=$DISPLAY \
    -v /tmp/.X11-unix:/tmp/.X11-unix \
    nathzi1505:darknet bash
</pre></div>
</div>
<p><strong>How to fix SSD Disk Space Constraints?</strong></p>
<p>Docker image builds will eat up lot of disk space, it is ideal to use HDD instead of SSD in case if you happened to have one!
Below are the steps to update the <code class="docutils literal notranslate"><span class="pre">root</span> <span class="pre">folder</span></code> of Docker download path to parquet the files.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo systemctl stop docker

sudo mv /var/lib/docker/ /opt/binaries/
sudo rm -rf /var/lib/docker
sudo ln -s /opt/binaries/docker/ /var/lib/docker

sudo vim /etc/docker/daemon.json\:

    {
        “data-path”: “/opt/binaries/docker”,
        “graph”: “/opt/binaries/docker”
    } 

sudo systemctl daemon-reload
sudo systemctl restart docker

sudo ls /opt/binaries/docker
    mageswarand@IMCHLT276:/opt/binaries/docker$ ls
    builder  buildkit  containers  image  network  overlay2  plugins  runtimes  swarm  tmp  trust  volumes
</pre></div>
</div>
<p>docker container top f1</p>
<p>In case if you face any face network issues with docker,
refer <a class="reference external" href="https://pythonspeed.com/articles/docker-connection-refused/">https://pythonspeed.com/articles/docker-connection-refused/</a></p>
</div>
<div class="section" id="misc">
<h2>2. Misc<a class="headerlink" href="#misc" title="Permalink to this headline">¶</a></h2>
<p><strong>Image Size Analysis</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://github.com/wagoodman/dive</span>
<span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">wagoodman</span><span class="o">/</span><span class="n">dive</span><span class="o">/</span><span class="n">releases</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="n">v0</span><span class="o">.</span><span class="mf">9.2</span><span class="o">/</span><span class="n">dive_0</span><span class="o">.</span><span class="mf">9.2</span><span class="n">_linux_amd64</span><span class="o">.</span><span class="n">deb</span>
<span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">./</span><span class="n">dive_0</span><span class="o">.</span><span class="mf">9.2</span><span class="n">_linux_amd64</span><span class="o">.</span><span class="n">deb</span>

<span class="n">dive</span> <span class="o">&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="n">tag</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><strong>Common commands</strong></p>
<ul class="simple">
<li><p>https://www.edureka.co/blog/docker-commands/</p></li>
<li><p>start the services</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">service</span> <span class="n">docker</span> <span class="n">start</span>
<span class="ow">or</span> 
<span class="n">systemctl</span> <span class="n">start</span> <span class="n">docker</span>
<span class="n">systemctl</span> <span class="n">enable</span> <span class="n">docker</span>
</pre></div>
</div>
<ul class="simple">
<li><p>build the image</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">build</span> <span class="o">--</span><span class="n">network</span> <span class="n">host</span> <span class="o">-</span><span class="n">f</span> <span class="n">docker</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">Dockerfile</span> <span class="o">-</span><span class="n">t</span> <span class="n">spacy</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="n">ner</span><span class="o">-</span><span class="n">python</span><span class="p">:</span><span class="n">latest</span> <span class="o">.</span>
</pre></div>
</div>
<ul class="simple">
<li><p>run docker in interactive mode</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">ti</span> <span class="n">spacy</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="n">ner</span><span class="o">-</span><span class="n">python</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
<ul class="simple">
<li><p>start the app</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5000</span><span class="p">:</span><span class="mi">5000</span> <span class="n">spacy</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="n">ner</span><span class="o">-</span><span class="n">python</span>
</pre></div>
</div>
<ul class="simple">
<li><p>list containers</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">container</span> <span class="n">ls</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
<ul class="simple">
<li><p>remove/delete Docker images</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker rmi id#
docker images -f dangling=true

# delete all dangling images without any references
docker image rm -f $(docker images -f dangling=true -aq)

docker system prune
docker images purge
</pre></div>
</div>
<ul class="simple">
<li><p>stop all the services/containers</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker stop $(docker ps -a -q)
docker rm $(docker ps -a -q)
</pre></div>
</div>
<ul class="simple">
<li><p>inspect</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>docker container inspect $(docker container ls --last 1 --format
&#39;{{.ID}}&#39;)
</pre></div>
</div>
<ul class="simple">
<li><p>When there is a change in the python code base, we obviously have to
rebuild the docker image, isn’t? Use following steps to do so:</p></li>
</ul>
<div class="highlight-shell script notranslate"><div class="highlight"><pre><span></span>docker container ls
docker stop {id}
docker rm {id}
docker build ...
# for multiple shells for same container
docker exec -it &lt;container&gt; bash
</pre></div>
</div>
<ul class="simple">
<li><p>Docker image disk usage : <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">system</span> <span class="pre">df</span></code></p></li>
<li><p><a class="reference external" href="https://stackoverflow.com/questions/33352901/get-the-size-of-a-docker-image-before-a-pull">Get the size of images befroe pull</a></p></li>
</ul>
<p><strong>Volumes</strong></p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference external" href="https://www.baeldung.com/ops/docker-volumes">https://www.baeldung.com/ops/docker-volumes</a></li>
<li class="toctree-l1"><a class="reference external" href="https://stackoverflow.com/questions/23439126/how-to-mount-a-host-directory-in-a-docker-container">https://stackoverflow.com/questions/23439126/how-to-mount-a-host-directory-in-a-docker-container</a></li>
</ul>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">virtualbox</span><span class="o">-</span><span class="n">guest</span><span class="o">-</span><span class="n">x11</span>
<span class="n">sudo</span> <span class="n">mount</span> <span class="o">-</span><span class="n">t</span> <span class="n">vboxsf</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">vlab</span><span class="o">/</span><span class="n">spark</span><span class="o">-</span><span class="n">streaming</span><span class="o">-</span><span class="n">playground</span><span class="o">/</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">dockerfolder</span>
</pre></div>
</div>
<p><strong>References</strong></p>
<ul class="simple">
<li><p>https://towardsdatascience.com/a-complete-guide-to-building-a-docker-image-serving-a-machine-learning-system-in-production-d8b5b0533bde</p></li>
<li><p><a class="reference external" href="https://www.bogotobogo.com/DevOps/DevOps-Kubernetes-1-Running-Kubernetes-Locally-via-Minikube.php">https://www.bogotobogo.com/DevOps/DevOps-Kubernetes-1-Running-Kubernetes-Locally-via-Minikube.php</a></p></li>
<li><p>https://blog.adriel.co.nz/2018/01/25/change-docker-data-directory-in-debian-jessie/</p></li>
<li><p>https://rominirani.com/docker-tutorial-series-part-7-data-volumes-93073a1b5b72</p></li>
<li><p>https://medium.com/rahasak/kafka-and-zookeeper-with-docker-65cff2c2c34f</p></li>
<li><p>https://github.com/sameersbn/docker-postgresql</p></li>
<li><p>https://github.com/kibatic/docker-single-node-hadoop/</p></li>
<li><p>https://github.com/bbonnin/docker-hadoop-3/blob/master/Dockerfile</p></li>
<li><p>Permission Denied Error &#64; https://stackoverflow.com/questions/47854463/docker-got-permission-denied-while-trying-to-connect-to-the-docker-daemon-socke</p></li>
<li><p>https://gist.github.com/nathzi1505/d2aab27ff93a3a9d82dada1336c45041</p></li>
</ul>
</div>
</div>


                        
                    </div>
                </div>
            </div>
        </div>
    </div>    


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  
    <div class="footer" role="contentinfo">
        <div class="container">
            &#169; Copyright 2021, Mozhi.
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.0.1.
        </div>
    </div>  

</body>
</html>
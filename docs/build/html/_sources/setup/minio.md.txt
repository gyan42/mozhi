# MinIO


## Setup

1. **Local**

Refer Install guide [here](https://min.io/download#/linux) and install both server and client using `deb` package method.

Note: The MinIO command line utility  has two aliases `mc` and `mcli`. Both are used interchageably by MinIO docs.

2. **Kubernetes**

[MinIO Operator](https://docs.min.io/minio/k8s/deployment/deploy-minio-operator.html):

YAML Reference Doc: https://github.com/minio/operator/blob/master/docs/crd.adoc


- Install operators/helm charts
  - Visit official [Krew](https://krew.sigs.k8s.io/docs/user-guide/setup/install/) for installation guide.
  - https://github.com/minio/direct-csi
  - https://kubectl.docs.kubernetes.io/installation/kustomize/


```shell
# create alias for quick and short commands
alias km='kubectl -n mozhi'

kubectl krew update
kubectl krew uninstall minio
kubectl krew install minio

kubectl create namespace minio-operator
kubectl minio init --namespace minio-operator
kubectl get all --namespace minio-operator

kubectl describe -n minio-operator pod/minio-operator-599dfb97-2vltk
kubectl logs -n minio-operator pod/minio-operator-599dfb97-kjhlh
kubectl logs -n minio-operator pod/console-789ff4b97b-gj4v7 

# To open Operator UI, start a port forward using this command: console http://localhost:9090
kubectl minio proxy -n minio-operator 

kubectl delete namespace minio-operator
```

- [MinIO tenant using command line](https://docs.min.io/minio/k8s/tenant-management/deploy-minio-tenant-using-commandline.html#deploy-minio-tenant-commandline)
```bash
kubectl delete namespace mozhi

kubectl create namespace mozhi
kubectl minio tenant create mozhitenant \
  --servers                 1  \
  --volumes                 4  \
  --capacity                16Gi  \
  --storage-class standard \
  --namespace               mozhi  \
  --output >> ops/k8s/minio/tenant.yaml


  Username: admin 
  Password: 52d14759-5853-4b25-88e9-debd85d1b0c9 
  Note: Copy the credentials to a secure location. MinIO will not display these again.

kubectl apply -f ops/k8s/minio/tenant.yaml

kubectl minio tenant delete mozhitenant 
kubectl apply -f ops/k8s/minio/autogenerated.yaml
kubectl exec -it pod/tenant-ss-0-0 -n mozhi -- bash
kubectl delete namespace minio-operator
```

- Test MinIO tenant

```shell
kubectl port-forward service/minio 9000:443 --namespace mozhi
kubectl port-forward service/mozhitenant-console 9443:9443 --namespace mozhi

mc alias set mozhiminio http://localhost:9000 admin f53bcf90-4341-4689-8233-0a4eaf401e61

km get pvc
km get pv

# delete
kubectl delete pvc -n mozhi $(kubectl get pvc --namespace mozhi | cut -d' ' -f1)
kubectl delete pv -n mozhi $(kubectl get pv --namespace mozhi | cut -d' ' -f1)
kubectl delete namespace mozhi
```

## Misc

- https://docs.min.io/docs/minio-admin-complete-guide.html

**Adding Keys**

```shell
mc alias set myminio http://192.168.0.142:9000 admin password
# or
mcli alias set myminio http://192.168.0.142:9000 BKIKJAA5BMMU2RHO6IBB V7f1CwQqAcwo80UEIJEjc5gVQUSSx5ohQ9GSrr12
```

Internal service name: YOURSERVICENAME.NAMESPACE.svc.cluster.local

**Password**
```shell
echo -n 'mozhi' | base64
echo -n 'bW96aGk=' | base64 -d

echo -n 'mozhi123' | base64
echo -n 'bW96aGkxMjM=' | base64 -d


echo -n 'YWRtaW4=' | base64 -d # admin
echo -n 'NzI5NDllYWItY2U1Yi00YWY2LWFlYmEtZjY3Y2RjZDkwMjdm' | base64 -d # 72949eab-ce5b-4af6-aeba-f67cdcd9027f

echo -n 'YmMzNjY2M2UtMzQzMC00ZWQwLWIwNWEtZTA4OTkwZWYwMjNl' | base64 -d # bc36663e-3430-4ed0-b05a-e08990ef023e
echo -n 'OGVhNDY5MmYtNDAyMy00MzQwLTliMGUtZjJlMGU1ZGRmNjI1' | base64 -d # 8ea4692f-4023-4340-9b0e-f2e0e5ddf625 

```

### References
- https://docs.min.io/docs/deploy-minio-on-kubernetes.html
- https://github.com/minio/operator/blob/master/README.md
- https://www.olivercoding.com/2021-03-01-kubernetes-minio-init/











```

# Persistent Volume by MinIO
kubectl krew install direct-csi
kubectl direct-csi install --crd
kubectl direct-csi drives ls
kubectl direct-csi drives format --drives  /dev/sda1 --nodes minikube --force
kubectl direct-csi info


- MinIO tenant using Kustomize
```shell
kubectl create namespace mozhi
kustomize build ops/k8s/minio/base | kubectl apply -f -
kustomize build ops/k8s/minio/tiny | kubectl apply -f -

kubectl delete pvc -n mozhi $(kubectl get pvc --namespace mozhi | cut -d' ' -f1)
kubectl delete pv -n mozhi $(kubectl get pv --namespace mozhi | cut -d' ' -f1)
kubectl delete namespace mozhi

#kubectl apply -f ops/k8s/minio/mozhi-tiny-tenant.yaml
```

- MinIO using Helm
```shell
helm repo add minio https://operator.min.io/
helm install --namespace mozhi --create-namespace --generate-name mozhi

```
```